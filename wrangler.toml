# XIV Dye Tools Discord Bot - Cloudflare Workers
# See: https://developers.cloudflare.com/workers/wrangler/configuration/

name = "xivdyetools-discord-worker"
main = "src/index.ts"
compatibility_date = "2024-12-01"
compatibility_flags = ["nodejs_compat"]

# ============================================================================
# KV Namespace for rate limiting and user preferences
# ============================================================================
[[kv_namespaces]]
binding = "KV"
id = "1fcb7e037ccd4172a47fccd97cf8e753"

# ============================================================================
# R2 Bucket for generated images (with 1hr expiry)
# Create with: wrangler r2 bucket create xivdyetools-bot-images
# ============================================================================
# [[r2_buckets]]
# binding = "IMAGES"
# bucket_name = "xivdyetools-bot-images"

# ============================================================================
# R2 Bucket for static assets (fonts)
# Can share with existing assets bucket if available
# ============================================================================
# [[r2_buckets]]
# binding = "ASSETS"
# bucket_name = "xivdyetools-assets"

# ============================================================================
# D1 Database (reuse existing presets database)
# ============================================================================
[[d1_databases]]
binding = "DB"
database_name = "xivdyetools-presets"
database_id = "e17d68a1-5a44-4c88-b02b-07d053cbe321"

# ============================================================================
# Service Binding to Preset API Worker (DISABLED)
# NOTE: Service bindings only work if both workers are in the same account.
# The xivdyetools-worker appears to be in a different account, so we use
# external URL fetch instead. Re-enable if workers are consolidated.
# ============================================================================
# [[services]]
# binding = "PRESETS_API"
# service = "xivdyetools-worker"

# ============================================================================
# Environment Variables (non-sensitive)
# ============================================================================
[vars]
# Discord Application ID (test app)
DISCORD_CLIENT_ID = "1447108133020369048"

# Presets API URL (existing worker)
PRESETS_API_URL = "https://xivdyetools-worker.ashejunius.workers.dev"

# ============================================================================
# Secrets (set via wrangler secret put):
# - DISCORD_TOKEN
# - DISCORD_PUBLIC_KEY
# - BOT_API_SECRET (for presets API auth)
# ============================================================================

# ============================================================================
# Binary file handling (fonts)
# ============================================================================
[[rules]]
type = "Data"
globs = ["**/*.ttf"]
fallthrough = true

# ============================================================================
# Production Environment
# ============================================================================
[env.production]
name = "xivdyetools-discord-worker"

[env.production.vars]
# Production Discord Application ID
DISCORD_CLIENT_ID = "1433508594426445878"
PRESETS_API_URL = "https://xivdyetools-worker.ashejunius.workers.dev"

